<?xml version="1.0" encoding="utf-8"?><!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.1//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_1.dtd'><nta><declaration>// Place global declarations here.
clock SysTimer;

// GearBox - GearControl
chan ReqSet, ReqNeu;
int [0,4]ErrStat;
chan GearSet, GearNeu;

// Clutch - GearControl
chan ClutchIsOpen, ClutchIsClosed;
chan OpenClutch, CloseClutch;

// Engine - GearControl
int [0,2]UseCase;
chan  ReqTorque, ReqZeroTorque, TorqueZero, SpeedSet;

//on hybrid engines : disel engine &amp; dc motor
int [0,1]id;
chan ReqSpeed[2];//two engines


// Interface - GearControl
chan ReqNewGear;
int [0,6]FromGear;
int [0,6]ToGear;
chan NewGear;

//drivingState - Interface
chan Acc, Uni, Dec;
const int topSpeed[5]={30,50,70,90,130};
const int groundSpeed[5]={0,20,30,60,80};
const int deltaArr[2][5]={
{5, 10, 20, 25, 30},//delta of engine
{10, 15, 20, 15, 5}//delta of motor
};
const int kArr[2][3]={
{6, 4, 3},// k  of engine
{4, 6, 8}//k of motor
};
int [30,130]Top;
int [0,80]Ground;

int [0,130]v;    //speed
int delta = 0;    // delta of v
int k = 1;    // 1/k is energy efficiency
meta int[-100000000000,100000000000] basic = 0;    //basic cost

chan Up, Down, Keep;
chan done;
chan chooseEngine;
chan changeEngine, changeDone;</declaration><template><name>driving</name><declaration>clock c;</declaration><location id="id0" x="736" y="-32"><name x="712" y="-24">waitForEngine2</name></location><location id="id1" x="80" y="176"><name x="24" y="144">waitForEngine1</name></location><location id="id2" x="-64" y="-136"><name x="-160" y="-168">waitForEngine</name></location><location id="id3" x="-96" y="24"><name x="-144" y="-8">readyTOStart</name><committed/></location><location id="id4" x="784" y="-248"><name x="774" y="-278">waitForGear2</name></location><location id="id5" x="536" y="111"><name x="536" y="128">waitForGearChange6</name></location><location id="id6" x="425" y="-8"><name x="328" y="0">waitForGearChange5</name></location><location id="id7" x="434" y="238"><name x="416" y="248">waitForGear1</name></location><location id="id8" x="161" y="68"><name x="0" y="48">waitForGearChange3</name></location><location id="id9" x="306" y="-8"><name x="248" y="-40">waitForGearChange4</name></location><location id="id10" x="408" y="-312"><name x="384" y="-344">waitForGearChange</name></location><location id="id11" x="40" y="-64"><name x="-8" y="-96">waitingGear1</name></location><location id="id12" x="553" y="-144" color="#000000"><name x="472" y="-192">decelerate</name><label kind="invariant" x="472" y="-176">v&gt;delta&amp;&amp;
cost'==basic*k</label></location><location id="id13" x="352" y="136" color="#000000"><name x="312" y="104">keep</name><label kind="invariant" x="312" y="144">cost'==basic*k</label></location><location id="id14" x="184" y="-136" color="#000000"><name x="216" y="-120">accelerate</name><label kind="invariant" x="216" y="-152">v&lt;=Top&amp;&amp;
cost'==basic*k</label></location><location id="id15" x="-208" y="104"><name x="-225" y="70">Init</name></location><init ref="id15"/><transition><source ref="id4"/><target ref="id12"/><label kind="guard" x="576" y="-249">v&lt;50</label><label kind="synchronisation" x="576" y="-232">done?</label><label kind="assignment" x="576" y="-215">k:=kArr[id][0],
c:=0</label><nail x="653" y="-253"/><nail x="576" y="-216"/></transition><transition><source ref="id4"/><target ref="id12"/><label kind="guard" x="752" y="-160">v&gt;=90</label><label kind="synchronisation" x="752" y="-144">done?</label><label kind="assignment" x="752" y="-128">k:=kArr[id][2],
c:=0</label><nail x="784" y="-152"/><nail x="704" y="-88"/></transition><transition><source ref="id6"/><target ref="id12"/><label kind="guard" x="456" y="-24">v&gt;=90</label><label kind="synchronisation" x="454" y="-13">done?</label><label kind="assignment" x="454" y="3">k:=kArr[id][2],
c:=0</label><nail x="525" y="-48"/></transition><transition><source ref="id6"/><target ref="id12"/><label kind="guard" x="391" y="-161">v&lt;50</label><label kind="synchronisation" x="392" y="-144">done?</label><label kind="assignment" x="392" y="-128">k:=kArr[id][0],
c:=0</label><nail x="434" y="-103"/></transition><transition><source ref="id8"/><target ref="id14"/><label kind="guard" x="48" y="-32">v&lt;50</label><label kind="synchronisation" x="48" y="-48">done?</label><label kind="assignment" x="48" y="-16">k:=kArr[id][0],
c:=0</label><nail x="104" y="-24"/></transition><transition><source ref="id8"/><target ref="id14"/><label kind="guard" x="208" y="8">v&gt;=90</label><label kind="synchronisation" x="208" y="-8">done?</label><label kind="assignment" x="208" y="24">k:=kArr[id][2],
c:=0</label><nail x="240" y="-16"/></transition><transition><source ref="id10"/><target ref="id14"/><label kind="guard" x="416" y="-264">v&gt;=90</label><label kind="synchronisation" x="416" y="-280">done?</label><label kind="assignment" x="416" y="-248">k:=kArr[id][2],
c:=0</label><nail x="416" y="-200"/><nail x="344" y="-136"/></transition><transition><source ref="id10"/><target ref="id14"/><label kind="guard" x="240" y="-312">v&lt;50</label><label kind="synchronisation" x="240" y="-296">done?</label><label kind="assignment" x="240" y="-280">k:=kArr[id][0],
c:=0</label><nail x="272" y="-296"/><nail x="224" y="-256"/></transition><transition><source ref="id0"/><target ref="id12"/><label kind="synchronisation" x="608" y="-8">changeDone?</label><label kind="assignment" x="608" y="-32">c:=0</label><nail x="612" y="-8"/></transition><transition><source ref="id12"/><target ref="id0"/><label kind="guard" x="624" y="-104">c==1</label><label kind="synchronisation" x="624" y="-88">changeEngine?</label></transition><transition><source ref="id1"/><target ref="id13"/><label kind="synchronisation" x="144" y="192">changeDone?</label><label kind="assignment" x="144" y="208">c:=0</label><nail x="208" y="224"/></transition><transition><source ref="id13"/><target ref="id1"/><label kind="guard" x="144" y="168">c==1</label><label kind="synchronisation" x="144" y="152">changeEngine?</label></transition><transition><source ref="id2"/><target ref="id14"/><label kind="synchronisation" x="8" y="-256">changeDone?</label><label kind="assignment" x="32" y="-232">c:=0</label><nail x="8" y="-216"/><nail x="88" y="-216"/></transition><transition><source ref="id14"/><target ref="id2"/><label kind="guard" x="-40" y="-160">c==1</label><label kind="synchronisation" x="-41" y="-138">changeEngine?</label></transition><transition><source ref="id15"/><target ref="id3"/><label kind="synchronisation" x="-232" y="40">chooseEngine!</label></transition><transition><source ref="id6"/><target ref="id12"/><label kind="guard" x="440" y="-104">v&gt;=50 &amp;&amp; v&lt;90</label><label kind="synchronisation" x="440" y="-88">done?</label><label kind="assignment" x="442" y="-76">k:=kArr[id][1],
c:=0</label></transition><transition><source ref="id9"/><target ref="id13"/><label kind="synchronisation" x="320" y="16">done?</label><label kind="assignment" x="320" y="32">c:=0</label></transition><transition><source ref="id8"/><target ref="id14"/><label kind="guard" x="152" y="-56">v&gt;=50 &amp;&amp; v&lt;90</label><label kind="synchronisation" x="152" y="-72">done?</label><label kind="assignment" x="152" y="-40">k:=kArr[id][1],
c:=0</label></transition><transition><source ref="id7"/><target ref="id13"/><label kind="synchronisation" x="400" y="168">done?</label><label kind="assignment" x="400" y="184">c:=0</label></transition><transition><source ref="id5"/><target ref="id13"/><label kind="synchronisation" x="424" y="104">done?</label><label kind="assignment" x="424" y="128">c:=0</label></transition><transition><source ref="id4"/><target ref="id12"/><label kind="guard" x="672" y="-184">v&gt;=50 &amp;&amp; v&lt;90</label><label kind="synchronisation" x="672" y="-232">done?</label><label kind="assignment" x="672" y="-216">k:=kArr[id][1],
c:=0</label><nail x="728" y="-192"/><nail x="664" y="-160"/></transition><transition><source ref="id10"/><target ref="id14"/><label kind="guard" x="296" y="-232">v&gt;=50 &amp;&amp; v&lt;90</label><label kind="synchronisation" x="296" y="-248">done?</label><label kind="assignment" x="296" y="-216">k:=kArr[id][1],
c:=0</label><nail x="360" y="-224"/><nail x="312" y="-176"/></transition><transition><source ref="id11"/><target ref="id14"/><label kind="synchronisation" x="85" y="-110">done?</label><label kind="assignment" x="83" y="-97">c:=0</label></transition><transition><source ref="id13"/><target ref="id8"/><label kind="guard" x="144" y="112">v&lt;Top&amp;&amp;
c==1</label><label kind="synchronisation" x="144" y="64">Acc!</label><label kind="assignment" x="144" y="80">v:=v+delta,
basic:=basic+1</label><nail x="196" y="128"/></transition><transition><source ref="id12"/><target ref="id5"/><label kind="guard" x="552" y="16">c==1</label><label kind="synchronisation" x="552" y="32">Uni!</label><nail x="544" y="68"/></transition><transition><source ref="id12"/><target ref="id4"/><label kind="guard" x="536" y="-288">v&gt;delta&amp;&amp;
c==1</label><label kind="synchronisation" x="536" y="-336">Dec!</label><label kind="assignment" x="536" y="-320">v:=v-delta,
basic:=basic-1</label><nail x="544" y="-256"/><nail x="624" y="-296"/></transition><transition><source ref="id13"/><target ref="id7"/><label kind="guard" x="328" y="240">c==1</label><label kind="synchronisation" x="332" y="221">Uni!</label><nail x="296" y="240"/></transition><transition><source ref="id14"/><target ref="id10"/><label kind="guard" x="144" y="-312">v&lt;Top&amp;&amp;
c==1</label><label kind="synchronisation" x="144" y="-360">Acc!</label><label kind="assignment" x="144" y="-344">v:=v+delta,
basic:=basic+1</label><nail x="176" y="-288"/><nail x="240" y="-336"/></transition><transition><source ref="id13"/><target ref="id6"/><label kind="guard" x="384" y="72">c==1</label><label kind="synchronisation" x="384" y="24">Dec!</label><label kind="assignment" x="384" y="40">v:=v-delta,
basic:=basic-1</label></transition><transition><source ref="id14"/><target ref="id9"/><label kind="guard" x="272" y="-96">v&gt;0&amp;&amp;
c==1</label><label kind="synchronisation" x="272" y="-64">Uni!</label><nail x="281" y="-34"/></transition><transition><source ref="id3"/><target ref="id11"/><label kind="synchronisation" x="-152" y="-72">Acc!</label><label kind="assignment" x="-152" y="-56">v:=0,Top:=topSpeed[0],
Ground:=groundSpeed[0]</label></transition></template><template><name>InterfaceController</name><location id="id16" x="-424" y="208" color="#ffff00"><name x="-434" y="178">chkGearChange54</name><committed/></location><location id="id17" x="-48" y="208" color="#ffff00"><name x="-58" y="178">chkGearChange43</name><committed/></location><location id="id18" x="120" y="-288" color="#ffff00"><name x="110" y="-318">chkGearChange32</name><committed/></location><location id="id19" x="-296" y="-288" color="#ffff00"><name x="-306" y="-318">chkGearChange21</name><committed/></location><location id="id20" x="-592" y="-144" color="#ffff00"><committed/></location><location id="id21" x="-424" y="56" color="#ffff00"><name x="-480" y="64">chkGearChange45</name><committed/></location><location id="id22" x="-56" y="56" color="#ffff00"><name x="-72" y="16">chkGearChange34</name><committed/></location><location id="id23" x="120" y="-144" color="#ffff00"><name x="88" y="-176">chkGearChange23</name><committed/></location><location id="id24" x="-296" y="-144" color="#ffff00"><name x="-328" y="-112">chkGearChange12</name><committed/></location><location id="id25" x="-592" y="56"><name x="-608" y="24">gear5</name></location><location id="id26" x="-248" y="56"><name x="-258" y="26">gear4</name></location><location id="id27" x="120" y="56"><name x="110" y="26">gear3</name></location><location id="id28" x="-120" y="-144"><name x="-130" y="-174">gear2</name></location><location id="id29" x="-464" y="-144"><name x="-474" y="-174">gear1</name></location><location id="id30" x="-672" y="-304"><name x="-682" y="-334">Init</name></location><init ref="id30"/><transition><source ref="id16"/><target ref="id25"/><label kind="guard" x="-568" y="102">v&gt;=groundSpeed[4]</label><label kind="synchronisation" x="-568" y="117">Keep!</label></transition><transition><source ref="id17"/><target ref="id26"/><label kind="guard" x="-208" y="102">v&gt;=groundSpeed[3]</label><label kind="synchronisation" x="-208" y="117">Keep!</label></transition><transition><source ref="id18"/><target ref="id27"/><label kind="guard" x="60" y="-146">v&gt;=groundSpeed[2]</label><label kind="synchronisation" x="60" y="-131">Keep!</label><nail x="232" y="-256"/><nail x="232" y="24"/></transition><transition><source ref="id19"/><target ref="id28"/><label kind="guard" x="-268" y="-246">v&gt;=groundSpeed[1]</label><label kind="synchronisation" x="-268" y="-231">Keep!</label></transition><transition><source ref="id16"/><target ref="id26"/><label kind="guard" x="-396" y="102">v&lt;groundSpeed[4]</label><label kind="synchronisation" x="-396" y="117">Down!</label><nail x="-296" y="208"/></transition><transition><source ref="id25"/><target ref="id16"/><label kind="synchronisation" x="-592" y="128">Dec?</label><nail x="-592" y="208"/></transition><transition><source ref="id17"/><target ref="id27"/><label kind="guard" x="-24" y="102">v&lt;groundSpeed[3]</label><label kind="synchronisation" x="-24" y="117">Down!</label><nail x="120" y="208"/></transition><transition><source ref="id26"/><target ref="id17"/><label kind="synchronisation" x="-208" y="117">Dec?</label><nail x="-248" y="208"/></transition><transition><source ref="id18"/><target ref="id28"/><label kind="guard" x="-60" y="-246">v&lt;groundSpeed[2]</label><label kind="synchronisation" x="-60" y="-231">Down!</label><nail x="-104" y="-288"/></transition><transition><source ref="id27"/><target ref="id18"/><label kind="synchronisation" x="224" y="-120">Dec?</label><nail x="264" y="56"/><nail x="264" y="-288"/></transition><transition><source ref="id19"/><target ref="id29"/><label kind="guard" x="-440" y="-246">v&lt;groundSpeed[1]</label><label kind="synchronisation" x="-440" y="-231">Down!</label><nail x="-464" y="-288"/></transition><transition><source ref="id28"/><target ref="id19"/><label kind="synchronisation" x="-192" y="-280">Dec?</label><nail x="-120" y="-288"/></transition><transition><source ref="id20"/><target ref="id29"/><label kind="synchronisation" x="-560" y="-160">Up!</label></transition><transition><source ref="id30"/><target ref="id20"/><label kind="synchronisation" x="-648" y="-240">Acc?</label></transition><transition><source ref="id21"/><target ref="id26"/><label kind="synchronisation" x="-320" y="-8">Keep!</label><nail x="-416" y="48"/><nail x="-336" y="0"/></transition><transition><source ref="id26"/><target ref="id21"/><label kind="synchronisation" x="-296" y="80">Uni?</label><nail x="-328" y="112"/></transition><transition><source ref="id27"/><target ref="id22"/><label kind="synchronisation" x="72" y="80">Uni?</label><nail x="40" y="112"/></transition><transition><source ref="id22"/><target ref="id27"/><label kind="synchronisation" x="16" y="-8">Keep!</label><nail x="32" y="0"/></transition><transition><source ref="id27"/><target ref="id22"/><label kind="synchronisation" x="-28" y="41">Acc?</label></transition><transition><source ref="id22"/><target ref="id26"/><label kind="guard" x="-212" y="26">v&gt;=groundSpeed[3]</label><label kind="synchronisation" x="-212" y="41">Up!</label></transition><transition><source ref="id26"/><target ref="id21"/><label kind="synchronisation" x="-396" y="41">Acc?</label></transition><transition><source ref="id21"/><target ref="id25"/><label kind="guard" x="-568" y="26">v&gt;=groundSpeed[4]</label><label kind="synchronisation" x="-568" y="41">Up!</label></transition><transition><source ref="id23"/><target ref="id28"/><label kind="synchronisation" x="-32" y="-96">Keep!</label><nail x="0" y="-96"/></transition><transition><source ref="id28"/><target ref="id23"/><label kind="synchronisation" x="8" y="-208">Uni?</label><nail x="0" y="-192"/></transition><transition><source ref="id29"/><target ref="id24"/><label kind="synchronisation" x="-376" y="-216">Uni?</label><nail x="-384" y="-216"/></transition><transition><source ref="id23"/><target ref="id27"/><label kind="guard" x="60" y="-74">v&gt;=groundSpeed[2]</label><label kind="synchronisation" x="96" y="-56">Up!</label></transition><transition><source ref="id28"/><target ref="id23"/><label kind="synchronisation" x="-32" y="-168">Acc?</label></transition><transition><source ref="id24"/><target ref="id29"/><label kind="synchronisation" x="-376" y="-96">Keep!</label><nail x="-384" y="-80"/></transition><transition><source ref="id24"/><target ref="id28"/><label kind="guard" x="-264" y="-144">v&gt;=groundSpeed[1]</label><label kind="synchronisation" x="-264" y="-168">Up!</label></transition><transition><source ref="id29"/><target ref="id24"/><label kind="synchronisation" x="-392" y="-160">Acc?</label></transition></template><template><name>Interface</name><location id="id31" x="528" y="1088"><committed/></location><location id="id32" x="512" y="800"><committed/></location><location id="id33" x="496" y="456"><committed/></location><location id="id34" x="440" y="88"><committed/></location><location id="id35" x="352" y="-280"><committed/></location><location id="id36" x="-314" y="93" color="#ffa500"><committed/></location><location id="id37" x="-264" y="-128" color="#ffa500"><committed/></location><location id="id38" x="352" y="1056" color="#ffa500"><committed/></location><location id="id39" x="328" y="736" color="#ffa500"><committed/></location><location id="id40" x="376" y="912" color="#ffa500"><committed/></location><location id="id41" x="320" y="384" color="#ffa500"><committed/></location><location id="id42" x="368" y="576" color="#ffa500"><committed/></location><location id="id43" x="304" y="56" color="#ffa500"><committed/></location><location id="id44" x="360" y="232" color="#ffa500"><committed/></location><location id="id45" x="336" y="-128" color="#ffa500"><committed/></location><location id="id46" x="88" y="-168" color="#ffa500"><committed/></location><location id="id47" x="-168" y="-232" color="#ffa500"><committed/></location><location id="id48" x="370" y="1114"><name x="387" y="1097">Gear5</name></location><location id="id49" x="400" y="1000"><name x="417" y="983">chkGear45</name></location><location id="id50" x="332" y="992"><name x="238" y="983">chkGear54</name></location><location id="id51" x="360" y="824"><name x="377" y="799">Gear4</name></location><location id="id52" x="388" y="661"><name x="405" y="644">chkGear34</name></location><location id="id53" x="312" y="661"><name x="227" y="653">chkGear43</name></location><location id="id54" x="349" y="477"><name x="366" y="451">Gear3</name></location><location id="id55" x="381" y="301"><name x="400" y="288">chkGear23</name></location><location id="id56" x="296" y="301"><name x="202" y="284">chkGear32</name></location><location id="id57" x="330" y="138"><name x="347" y="121">Gear2</name></location><location id="id58" x="368" y="-32"><name x="385" y="-49">chkGear12</name></location><location id="id59" x="275" y="-32"><name x="190" y="-40">chkGear21</name></location><location id="id60" x="306" y="-212"><name x="298" y="-246">Gear1</name></location><location id="id61" x="-75" y="-149"><name x="-109" y="-140">chkGear1N</name></location><location id="id62" x="-66" y="-259"><name x="-75" y="-293">chkGearN1</name></location><location id="id63" x="-288" y="144"><name x="-314" y="152">GearR</name></location><location id="id64" x="-220" y="-26"><name x="-220" y="-18">chkGearNR</name></location><location id="id65" x="-348" y="-26"><name x="-407" y="-60">chkGearRN</name></location><location id="id66" x="-296" y="-200"><name x="-304" y="-225">GearN</name></location><init ref="id66"/><transition><source ref="id31"/><target ref="id48"/><label kind="synchronisation" x="512" y="1104">done!</label><nail x="504" y="1128"/></transition><transition><source ref="id32"/><target ref="id51"/><label kind="synchronisation" x="432" y="784">done!</label></transition><transition><source ref="id33"/><target ref="id54"/><label kind="synchronisation" x="496" y="480">done!</label><nail x="493" y="502"/></transition><transition><source ref="id34"/><target ref="id57"/><label kind="synchronisation" x="456" y="128">done!</label><nail x="458" y="164"/></transition><transition><source ref="id35"/><target ref="id60"/><label kind="synchronisation" x="336" y="-264">done!</label></transition><transition><source ref="id60"/><target ref="id35"/><label kind="synchronisation" x="256" y="-264">Keep?</label><nail x="281" y="-280"/></transition><transition><source ref="id48"/><target ref="id31"/><label kind="synchronisation" x="456" y="1088">Keep?</label><nail x="387" y="1106"/></transition><transition><source ref="id51"/><target ref="id32"/><label kind="synchronisation" x="520" y="816">Keep?</label><nail x="377" y="824"/><nail x="512" y="848"/></transition><transition><source ref="id54"/><target ref="id33"/><label kind="synchronisation" x="416" y="440">Keep?</label></transition><transition><source ref="id57"/><target ref="id34"/><label kind="synchronisation" x="368" y="88">Keep?</label></transition><transition><source ref="id63"/><target ref="id36"/><label kind="synchronisation" x="-365" y="101">Up?</label></transition><transition><source ref="id66"/><target ref="id37"/><label kind="synchronisation" x="-338" y="-183">Down?</label></transition><transition><source ref="id48"/><target ref="id38"/><label kind="synchronisation" x="312" y="1080">Down?</label></transition><transition><source ref="id51"/><target ref="id40"/><label kind="synchronisation" x="317" y="841">Up?</label></transition><transition><source ref="id51"/><target ref="id39"/><label kind="synchronisation" x="296" y="776">Down?</label></transition><transition><source ref="id54"/><target ref="id42"/><label kind="synchronisation" x="368" y="512">Up?</label></transition><transition><source ref="id54"/><target ref="id41"/><label kind="synchronisation" x="280" y="416">Down?</label></transition><transition><source ref="id57"/><target ref="id44"/><label kind="synchronisation" x="352" y="168">Up?</label></transition><transition><source ref="id57"/><target ref="id43"/><label kind="synchronisation" x="272" y="96">Down?</label><nail x="330" y="121"/></transition><transition><source ref="id60"/><target ref="id45"/><label kind="synchronisation" x="323" y="-204">Up?</label></transition><transition><source ref="id60"/><target ref="id46"/><label kind="synchronisation" x="176" y="-184">Down?</label></transition><transition><source ref="id66"/><target ref="id47"/><label kind="synchronisation" x="-253" y="-225">Up?</label></transition><transition><source ref="id50"/><target ref="id51"/><label kind="synchronisation" x="192" y="872">NewGear?</label><label kind="assignment" x="192" y="896">Top:=topSpeed[3],
Ground:=groundSpeed[3],
delta:=deltaArr[id][3]</label></transition><transition><source ref="id38"/><target ref="id50"/><label kind="synchronisation" x="224" y="1008">ReqNewGear!</label><label kind="assignment" x="224" y="1032">FromGear:=5,
ToGear:=4</label></transition><transition><source ref="id49"/><target ref="id48"/><label kind="synchronisation" x="392" y="1016">NewGear?</label><label kind="assignment" x="392" y="1032">Top:=topSpeed[4],
Ground:=groundSpeed[4],
delta:=deltaArr[id][4]</label></transition><transition><source ref="id40"/><target ref="id49"/><label kind="synchronisation" x="400" y="912">ReqNewGear!</label><label kind="assignment" x="400" y="928">FromGear:=4,
ToGear:=5</label></transition><transition><source ref="id53"/><target ref="id54"/><label kind="synchronisation" x="200" y="536">NewGear?</label><label kind="assignment" x="200" y="552">Top:=topSpeed[2],
Ground:=groundSpeed[2],
delta:=deltaArr[id][2]</label></transition><transition><source ref="id39"/><target ref="id53"/><label kind="synchronisation" x="235" y="687">ReqNewGear!</label><label kind="assignment" x="232" y="704">FromGear:=4,
ToGear:=3</label></transition><transition><source ref="id52"/><target ref="id51"/><label kind="synchronisation" x="380" y="695">NewGear?</label><label kind="assignment" x="376" y="712">Top:=topSpeed[3],
Ground:=groundSpeed[3],
delta:=deltaArr[id][3]</label></transition><transition><source ref="id42"/><target ref="id52"/><label kind="synchronisation" x="384" y="584">ReqNewGear!</label><label kind="assignment" x="384" y="600">FromGear:=3,
ToGear:=4</label></transition><transition><source ref="id56"/><target ref="id57"/><label kind="synchronisation" x="144" y="184">NewGear?</label><label kind="assignment" x="144" y="200">Top:=topSpeed[1],
Ground:=groundSpeed[1],
delta:=deltaArr[id][1]</label></transition><transition><source ref="id41"/><target ref="id56"/><label kind="synchronisation" x="211" y="327">ReqNewGear!</label><label kind="assignment" x="216" y="344">FromGear:=3,
ToGear:=2</label></transition><transition><source ref="id55"/><target ref="id54"/><label kind="synchronisation" x="372" y="335">NewGear?</label><label kind="assignment" x="368" y="352">Top:=topSpeed[2],
Ground:=groundSpeed[2],
delta:=deltaArr[id][2]</label></transition><transition><source ref="id44"/><target ref="id55"/><label kind="synchronisation" x="376" y="232">ReqNewGear!</label><label kind="assignment" x="376" y="248">FromGear:=2,
ToGear:=3</label></transition><transition><source ref="id59"/><target ref="id60"/><label kind="synchronisation" x="152" y="-144">NewGear?</label><label kind="assignment" x="152" y="-128">Top:=topSpeed[0],
Ground:=groundSpeed[0],
delta:=deltaArr[id][0]</label></transition><transition><source ref="id43"/><target ref="id59"/><label kind="synchronisation" x="207" y="-6">ReqNewGear!</label><label kind="assignment" x="208" y="16">FromGear:=2,
ToGear:=1</label></transition><transition><source ref="id58"/><target ref="id57"/><label kind="synchronisation" x="343" y="-6">NewGear?</label><label kind="assignment" x="344" y="8">Top:=topSpeed[1],
Ground:=groundSpeed[1],
delta:=deltaArr[id][1]</label></transition><transition><source ref="id45"/><target ref="id58"/><label kind="synchronisation" x="376" y="-128">ReqNewGear!</label><label kind="assignment" x="376" y="-112">FromGear:=1,
ToGear:=2</label></transition><transition><source ref="id61"/><target ref="id66"/><label kind="synchronisation" x="-211" y="-191">NewGear?</label></transition><transition><source ref="id46"/><target ref="id61"/><label kind="synchronisation" x="-16" y="-153">ReqNewGear!</label><label kind="assignment" x="-16" y="-136">FromGear:=1,
ToGear:=0</label></transition><transition><source ref="id62"/><target ref="id60"/><label kind="synchronisation" x="32" y="-288">NewGear?</label><label kind="assignment" x="32" y="-272">Top:=topSpeed[0],
Ground:=groundSpeed[0],
delta:=deltaArr[id][0]</label></transition><transition><source ref="id47"/><target ref="id62"/><label kind="synchronisation" x="-169" y="-301">ReqNewGear!</label><label kind="assignment" x="-168" y="-285">FromGear:=0,
ToGear:=1</label></transition><transition><source ref="id65"/><target ref="id66"/><label kind="synchronisation" x="-381" y="-166">NewGear?</label></transition><transition><source ref="id36"/><target ref="id65"/><label kind="synchronisation" x="-399" y="25">ReqNewGear!</label><label kind="assignment" x="-399" y="50">FromGear:=6,
ToGear:=0</label></transition><transition><source ref="id64"/><target ref="id63"/><label kind="synchronisation" x="-263" y="67">NewGear?</label></transition><transition><source ref="id37"/><target ref="id64"/><label kind="synchronisation" x="-256" y="-105">ReqNewGear!</label><label kind="assignment" x="-248" y="-88">FromGear:=0,
ToGear:=6</label></transition></template><template><name x="5" y="5">GearControl</name><declaration>// Place local declarations here.
clock GCTimer;</declaration><location id="id67" x="-560" y="-256"><committed/></location><location id="id68" x="-374" y="331" color="#ffff00"><name x="-365" y="323">ReqSetGear</name><committed/></location><location id="id69" x="-25" y="654"></location><location id="id70" x="-374" y="654" color="#ffff00"><name x="-365" y="620">GearChanged</name><committed/></location><location id="id71" x="-136" y="612" color="#ff0000"><name x="-146" y="578">CCloseError</name></location><location id="id72" x="-238" y="510"><name x="-280" y="476">CheckClutchClosed</name><label kind="invariant" x="-246" y="459">(GCTimer&lt;=200)</label></location><location id="id73" x="-374" y="510" color="#ffff00"><name x="-374" y="518">ReqTorqueC</name><committed/></location><location id="id74" x="-136" y="416" color="#ff0000"><name x="-161" y="433">GSetError</name></location><location id="id75" x="-374" y="416"><name x="-365" y="416">CheckGearSet1</name><label kind="invariant" x="-365" y="433">(GCTimer&lt;=350)</label></location><location id="id76" x="0" y="510" color="#ffff00"><name x="17" y="501">ClutchClose</name><committed/></location><location id="id77" x="0" y="416"><name x="8" y="416">CheckGearSet2</name><label kind="invariant" x="25" y="433">(GCTimer&lt;=350)</label></location><location id="id78" x="0" y="331" color="#ffff00"><name x="8" y="314">ClutchOpen</name><committed/></location><location id="id79" x="136" y="212" color="#ffff00"><name x="144" y="221">ReqSetGear2</name><committed/></location><location id="id80" x="-68" y="238"><name x="-68" y="204">CheckClutch</name><label kind="invariant" x="-51" y="221">(GCTimer&lt;=200)</label></location><location id="id81" x="-374" y="238"><name x="-374" y="246">CheckSyncSpeed</name><label kind="invariant" x="-365" y="263">(GCTimer&lt;=155)</label></location><location id="id82" x="-374" y="170" color="#ffff00"><name x="-357" y="153">ReqSyncSpeed</name><committed/></location><location id="id83" x="136" y="136"><name x="153" y="110">CheckGearNeu2</name><label kind="invariant" x="170" y="136">(GCTimer&lt;=250)</label></location><location id="id84" x="136" y="-34" color="#ffff00"><name x="153" y="-51">ClutchOpen2</name><committed/></location><location id="id85" x="0" y="136" color="#ff0000"><name x="-10" y="102">GNeuError</name></location><location id="id86" x="-68" y="34" color="#ff0000"><name x="-51" y="25">COpenError</name></location><location id="id87" x="-374" y="93"><name x="-365" y="68">CheckGearNeu</name><label kind="invariant" x="-365" y="93">(GCTimer&lt;=250)</label></location><location id="id88" x="-374" y="0" color="#ffff00"><name x="-357" y="-8">ReqNueGear</name><committed/></location><location id="id89" x="-68" y="-102"><name x="-59" y="-102">CheckClutch2</name><label kind="invariant" x="-51" y="-85">(GCTimer&lt;=200)</label></location><location id="id90" x="-374" y="-102"><name x="-365" y="-102">CheckTorque</name><label kind="invariant" x="-365" y="-85">(GCTimer&lt;=255)</label></location><location id="id91" x="-374" y="-195" color="#ffff00"><name x="-357" y="-212">Initiate</name><committed/></location><location id="id92" x="-374" y="-323"><name x="-384" y="-357">Gear</name></location><init ref="id92"/><transition><source ref="id67"/><target ref="id92"/><label kind="synchronisation" x="-527" y="-304">done!</label></transition><transition><source ref="id69"/><target ref="id71"/><label kind="guard" x="-51" y="586">GCTimer&gt;150&amp;&amp;GCTimer&lt;=200</label><nail x="-25" y="612"/></transition><transition><source ref="id72"/><target ref="id71"/><label kind="guard" x="-280" y="544">GCTimer&gt;150&amp;&amp;GCTimer&lt;=200</label><nail x="-238" y="612"/></transition><transition><source ref="id68"/><target ref="id75"/><label kind="synchronisation" x="-374" y="348">ReqSet!</label><label kind="assignment" x="-374" y="365">GCTimer:=0</label></transition><transition><source ref="id81"/><target ref="id68"/><label kind="guard" x="-365" y="297">GCTimer&lt;150</label><label kind="synchronisation" x="-374" y="280">SpeedSet?</label></transition><transition><source ref="id70"/><target ref="id67"/><label kind="synchronisation" x="-654" y="144">NewGear!</label><nail x="-578" y="408"/><nail x="-576" y="-256"/></transition><transition><source ref="id82"/><target ref="id70"/><label kind="guard" x="-527" y="289">ToGear&lt;=0</label><nail x="-442" y="204"/><nail x="-442" y="450"/></transition><transition><source ref="id79"/><target ref="id69"/><label kind="guard" x="153" y="484">ToGear==0</label><label kind="synchronisation" x="153" y="501">CloseClutch!</label><label kind="assignment" x="153" y="518">GCTimer:=0</label><nail x="238" y="212"/><nail x="238" y="586"/><nail x="178" y="654"/></transition><transition><source ref="id69"/><target ref="id70"/><label kind="synchronisation" x="-356" y="637">ClutchIsClosed?</label></transition><transition><source ref="id73"/><target ref="id70"/><label kind="synchronisation" x="-374" y="565">ReqTorque!</label></transition><transition><source ref="id72"/><target ref="id73"/><label kind="synchronisation" x="-356" y="493">ClutchIsClosed?</label></transition><transition><source ref="id75"/><target ref="id73"/><label kind="synchronisation" x="-374" y="459">GearSet?</label></transition><transition><source ref="id76"/><target ref="id72"/><label kind="synchronisation" x="-153" y="493">CloseClutch!</label><label kind="assignment" x="-144" y="510">GCTimer:=0</label></transition><transition><source ref="id77"/><target ref="id74"/><label kind="guard" x="-119" y="365">GCTimer&gt;300&amp;&amp;
GCTimer&lt;=350</label></transition><transition><source ref="id75"/><target ref="id74"/><label kind="guard" x="-280" y="374">GCTimer&gt;300&amp;&amp;
GCTimer&lt;=350</label></transition><transition><source ref="id79"/><target ref="id77"/><label kind="guard" x="135" y="272">ToGear&gt;0</label><label kind="synchronisation" x="135" y="297">ReqSet!</label><label kind="assignment" x="136" y="314">GCTimer:=0</label><nail x="135" y="382"/></transition><transition><source ref="id77"/><target ref="id76"/><label kind="synchronisation" x="0" y="459">GearSet?</label></transition><transition><source ref="id78"/><target ref="id77"/><label kind="synchronisation" x="0" y="356">ReqSet!</label><label kind="assignment" x="0" y="374">GCTimer:=0</label></transition><transition><source ref="id80"/><target ref="id78"/><label kind="synchronisation" x="-93" y="272">ClutchIsOpen?</label><nail x="0" y="238"/></transition><transition><source ref="id83"/><target ref="id79"/><label kind="synchronisation" x="136" y="161">GearNeu?</label></transition><transition><source ref="id80"/><target ref="id86"/><label kind="guard" x="-170" y="178">GCTimer&gt;150&amp;&amp;GCTimer&lt;=200</label></transition><transition><source ref="id81"/><target ref="id80"/><label kind="guard" x="-221" y="238">GCTimer&gt;=150</label><label kind="synchronisation" x="-212" y="221">OpenClutch!</label><label kind="assignment" x="-204" y="255">GCTimer:=0</label><nail x="-365" y="238"/></transition><transition><source ref="id91"/><target ref="id82"/><label kind="guard" x="-535" y="-8">FromGear&lt;=0</label><nail x="-442" y="-144"/><nail x="-442" y="144"/></transition><transition><source ref="id83"/><target ref="id85"/></transition><transition><source ref="id84"/><target ref="id83"/><label kind="synchronisation" x="136" y="34">ReqNeu!</label><label kind="assignment" x="136" y="51">GCTimer:=0</label></transition><transition><source ref="id89"/><target ref="id84"/><label kind="synchronisation" x="51" y="-119">ClutchIsOpen?</label><nail x="136" y="-102"/></transition><transition><source ref="id87"/><target ref="id85"/><label kind="guard" x="-297" y="136">GCTimer&gt;200&amp;&amp;GCTimer&lt;=250</label><nail x="-238" y="93"/><nail x="-238" y="136"/></transition><transition><source ref="id82"/><target ref="id81"/><label kind="guard" x="-348" y="170">ToGear&gt;0</label><label kind="synchronisation" x="-348" y="187">ReqSpeed[id]!</label><label kind="assignment" x="-348" y="204">GCTimer:=0</label></transition><transition><source ref="id87"/><target ref="id82"/><label kind="synchronisation" x="-374" y="119">GearNeu?</label></transition><transition><source ref="id89"/><target ref="id86"/><label kind="guard" x="-161" y="-25">GCTimer&gt;150&amp;&amp;GCTimer&lt;=200</label></transition><transition><source ref="id88"/><target ref="id87"/><label kind="synchronisation" x="-374" y="29">ReqNeu!</label><label kind="assignment" x="-374" y="46">GCTimer:=0</label></transition><transition><source ref="id90"/><target ref="id88"/><label kind="guard" x="-374" y="-42">GCTimer&lt;250</label><label kind="synchronisation" x="-374" y="-59">TorqueZero?</label></transition><transition><source ref="id90"/><target ref="id89"/><label kind="guard" x="-195" y="-127">GCTimer&gt;=250</label><label kind="synchronisation" x="-195" y="-144">OpenClutch!</label><label kind="assignment" x="-187" y="-102">GCTimer:=0</label></transition><transition><source ref="id91"/><target ref="id90"/><label kind="guard" x="-357" y="-178">FromGear&gt;0</label><label kind="synchronisation" x="-357" y="-161">ReqZeroTorque!</label><label kind="assignment" x="-357" y="-144">GCTimer:=0</label></transition><transition><source ref="id92"/><target ref="id91"/><label kind="synchronisation" x="-365" y="-289">ReqNewGear?</label><label kind="assignment" x="-365" y="-272">SysTimer:=0</label></transition></template><template><name>GearBox</name><declaration>clock GBTimer;</declaration><location id="id93" x="-110" y="17" color="#ff0000"><name x="-93" y="1">ErrorIdle</name></location><location id="id94" x="-238" y="93"><name x="-306" y="102">Closing</name><label kind="invariant" x="-248" y="110">(GBTimer&lt;=300)</label></location><location id="id95" x="127" y="93"><name x="161" y="76">Idle</name></location><location id="id96" x="-17" y="-42" color="#ff0000"><name x="-85" y="-59">ErrorNeu</name></location><location id="id97" x="-238" y="-127"><name x="-272" y="-161">Neutral</name></location><location id="id98" x="127" y="-127"><name x="144" y="-153">Opening</name><label kind="invariant" x="144" y="-136">(GBTimer&lt;=200)</label></location><init ref="id97"/><transition><source ref="id97"/><target ref="id94"/><label kind="synchronisation" x="-314" y="-34">ReqSet?</label><label kind="assignment" x="-314" y="-17">GBTimer:=0</label></transition><transition><source ref="id94"/><target ref="id93"/><label kind="guard" x="-170" y="42">GBTimer==300</label><label kind="assignment" x="-161" y="59">ErrStat:=3</label></transition><transition><source ref="id94"/><target ref="id95"/><label kind="guard" x="-68" y="93">GBTimer&gt;=100</label><label kind="synchronisation" x="-59" y="110">GearSet!</label></transition><transition><source ref="id98"/><target ref="id96"/><label kind="guard" x="-17" y="-110">GBTimer&gt;200</label><label kind="assignment" x="-17" y="-93">ErrStat:=4</label></transition><transition><source ref="id95"/><target ref="id98"/><label kind="synchronisation" x="144" y="-59">ReqNeu?</label><label kind="assignment" x="144" y="-34">GBTimer:=0</label></transition><transition><source ref="id98"/><target ref="id97"/><label kind="guard" x="-93" y="-170">GBTimer&gt;=100</label><label kind="synchronisation" x="-76" y="-153">GearNeu!</label></transition></template><template><name>Clutch</name><declaration>clock CTimer;</declaration><location id="id99" x="-246" y="-51" color="#ff0000"><name x="-331" y="-59">ErrorClose</name></location><location id="id100" x="-119" y="34"><name x="-102" y="17">Closing</name><label kind="invariant" x="-102" y="34">(CTimer&lt;=150)</label></location><location id="id101" x="-365" y="-102" color="#ff0000"><name x="-348" y="-110">ErrorOpen</name></location><location id="id102" x="-510" y="-229"><name x="-518" y="-272">Opening</name><label kind="invariant" x="-493" y="-255">(CTimer&lt;=150)</label></location><location id="id103" x="-119" y="-229"><name x="-129" y="-263">Open</name></location><location id="id104" x="-510" y="34"><name x="-520" y="0">Closed</name></location><init ref="id104"/><transition><source ref="id103"/><target ref="id100"/><label kind="synchronisation" x="-119" y="-127">CloseClutch?</label><label kind="assignment" x="-119" y="-110">CTimer:=0</label></transition><transition><source ref="id102"/><target ref="id103"/><label kind="guard" x="-357" y="-229">CTimer&gt;=100</label><label kind="synchronisation" x="-357" y="-246">ClutchIsOpen!</label></transition><transition><source ref="id104"/><target ref="id102"/><label kind="synchronisation" x="-586" y="-110">OpenClutch?</label><label kind="assignment" x="-510" y="-97">CTimer:=0</label></transition><transition><source ref="id100"/><target ref="id104"/><label kind="guard" x="-374" y="34">CTimer&gt;=100</label><label kind="synchronisation" x="-382" y="17">ClutchIsClosed!</label></transition><transition><source ref="id100"/><target ref="id99"/><label kind="guard" x="-221" y="-51">CTimer==150</label><label kind="assignment" x="-195" y="-34">ErrStat:=1</label></transition><transition><source ref="id102"/><target ref="id101"/><label kind="guard" x="-493" y="-144">CTimer==150</label><label kind="assignment" x="-467" y="-127">ErrStat:=2</label></transition></template><template><name>EngineScheduler</name><location id="id105" x="-195" y="42"><name x="-288" y="32">engineSpeed</name><committed/></location><location id="id106" x="-136" y="144"><name x="-264" y="136">engineFindSpeed</name></location><location id="id107" x="-161" y="-161"><name x="-248" y="-184">motorSpeed</name><committed/></location><location id="id108" x="-102" y="-246"><name x="-208" y="-272">motorFindSpeed</name></location><location id="id109" x="-272" y="-25"><name x="-312" y="-8">motorTorque</name><committed/></location><location id="id110" x="-272" y="-93"><name x="-312" y="-136">engineTorque</name><committed/></location><location id="id111" x="-374" y="289"><name x="-480" y="264">startResetMotor</name></location><location id="id112" x="-374" y="-357"><name x="-432" y="-392">startResetEngine</name></location><location id="id113" x="-52" y="289"><name x="-32" y="272">motorZero</name><committed/></location><location id="id114" x="-188" y="289"><name x="-216" y="256">motorDecTorque</name></location><location id="id115" x="-17" y="-357"><name x="-8" y="-400">engineZero</name><committed/></location><location id="id116" x="-153" y="-357"><name x="-208" y="-392">engineDecTorque</name></location><location id="id117" x="-374" y="8"><name x="-391" y="25">useMotor</name></location><location id="id118" x="-374" y="-136"><name x="-384" y="-170">useEngine</name></location><location id="id119" x="-535" y="-68"><name x="-545" y="-102">stop</name></location><init ref="id119"/><transition><source ref="id105"/><target ref="id110"/><label kind="synchronisation" x="-254" y="-42">ReqTorque!</label></transition><transition><source ref="id106"/><target ref="id105"/><label kind="synchronisation" x="-165" y="76">SpeedSet?</label><label kind="assignment" x="-165" y="93">delta:=deltaArr[id][ToGear-1]</label></transition><transition><source ref="id107"/><target ref="id109"/><label kind="synchronisation" x="-212" y="-119">ReqTorque!</label></transition><transition><source ref="id108"/><target ref="id107"/><label kind="synchronisation" x="-136" y="-204">SpeedSet?</label><label kind="assignment" x="-144" y="-178">delta:=deltaArr[id][ToGear-1]</label></transition><transition><source ref="id109"/><target ref="id117"/><label kind="synchronisation" x="-356" y="-25">changeDone!</label></transition><transition><source ref="id110"/><target ref="id118"/><label kind="synchronisation" x="-356" y="-119">changeDone!</label></transition><transition><source ref="id117"/><target ref="id111"/><label kind="synchronisation" x="-472" y="184">changeEngine!</label></transition><transition><source ref="id118"/><target ref="id112"/><label kind="synchronisation" x="-472" y="-280">changeEngine!</label><nail x="-374" y="-340"/></transition><transition><source ref="id113"/><target ref="id106"/><label kind="synchronisation" x="-118" y="199">ReqSpeed[0]!</label><label kind="assignment" x="-59" y="221">id:=0</label></transition><transition><source ref="id114"/><target ref="id113"/><label kind="synchronisation" x="-170" y="272">TorqueZero?</label></transition><transition><source ref="id111"/><target ref="id114"/><label kind="synchronisation" x="-336" y="256">ReqZeroTorque!</label></transition><transition><source ref="id115"/><target ref="id108"/><label kind="synchronisation" x="-68" y="-289">ReqSpeed[1]!</label><label kind="assignment" x="-51" y="-263">id:=1</label></transition><transition><source ref="id116"/><target ref="id115"/><label kind="synchronisation" x="-135" y="-374">TorqueZero?</label></transition><transition><source ref="id112"/><target ref="id116"/><label kind="synchronisation" x="-328" y="-352">ReqZeroTorque!</label></transition><transition><source ref="id119"/><target ref="id117"/><label kind="synchronisation" x="-492" y="-47">chooseEngine?</label><label kind="assignment" x="-493" y="-42">id:=1</label></transition><transition><source ref="id119"/><target ref="id118"/><label kind="synchronisation" x="-517" y="-119">chooseEngine?</label><label kind="assignment" x="-493" y="-110">id:=0</label></transition></template><template><name>Engine</name><declaration>clock ETimer;</declaration><location id="id120" x="212" y="-144"><name x="127" y="-187">DecTorque</name><label kind="invariant" x="102" y="-170">(ETimer&lt;=400)</label></location><location id="id121" x="212" y="221"><name x="238" y="221">Zero</name></location><location id="id122" x="-34" y="221"><name x="-127" y="221">FindSpeed</name><label kind="invariant" x="-110" y="238">(ETimer&lt;=200)</label></location><location id="id123" x="-34" y="-17" color="#ffff00"><name x="-25" y="-42">ClutchOpen</name><committed/></location><location id="id124" x="-255" y="-17"><name x="-339" y="-25">ClutchClose</name><label kind="invariant" x="-331" y="-8">(ETimer&lt;=900)</label></location><location id="id125" x="-255" y="280" color="#ff0000"><name x="-238" y="272">ErrorSpeed</name></location><location id="id126" x="-374" y="221"><name x="-425" y="170">Speed</name><label kind="invariant" x="-408" y="187">(ETimer&lt;=500)</label></location><location id="id127" x="-374" y="-144"><name x="-384" y="-178">Torque</name></location><location id="id128" x="76" y="59"><name x="66" y="25">Initial</name></location><init ref="id128"/><transition><source ref="id122"/><target ref="id123"/><label kind="guard" x="-85" y="42">ETimer==200</label><label kind="assignment" x="-85" y="59">UseCase:=2</label></transition><transition><source ref="id121"/><target ref="id128"/><label kind="guard" x="93" y="93">ToGear==0</label></transition><transition><source ref="id128"/><target ref="id122"/><label kind="synchronisation" x="17" y="136">ReqSpeed[0]?</label><label kind="assignment" x="17" y="153">ETimer:=0,
UseCase:=0</label></transition><transition><source ref="id123"/><target ref="id128"/><label kind="guard" x="-8" y="-8">ToGear==0</label></transition><transition><source ref="id120"/><target ref="id123"/><label kind="guard" x="25" y="-102">ETimer==400</label><label kind="assignment" x="34" y="-85">UseCase:=1</label><nail x="-17" y="-93"/></transition><transition><source ref="id123"/><target ref="id124"/><label kind="guard" x="-195" y="-34">ToGear&gt;0</label><label kind="assignment" x="-194" y="-21">ETimer:=0</label></transition><transition><source ref="id124"/><target ref="id127"/><label kind="guard" x="-323" y="-102">ETimer&gt;=50</label><label kind="synchronisation" x="-340" y="-119">ReqTorque?</label></transition><transition><source ref="id124"/><target ref="id125"/><label kind="guard" x="-255" y="51">ETimer==900</label></transition><transition><source ref="id126"/><target ref="id125"/><label kind="guard" x="-391" y="255">ETimer==500</label></transition><transition><source ref="id122"/><target ref="id126"/><label kind="guard" x="-221" y="195">ETimer&gt;=50</label><label kind="synchronisation" x="-221" y="212">SpeedSet!</label><label kind="assignment" x="-221" y="229">ETimer:=0</label></transition><transition><source ref="id121"/><target ref="id122"/><label kind="guard" x="76" y="221">ToGear&gt;0</label><label kind="synchronisation" x="76" y="238">ReqSpeed[0]?</label><label kind="assignment" x="76" y="255">ETimer:=0</label></transition><transition><source ref="id120"/><target ref="id121"/><label kind="guard" x="212" y="17">ETimer&gt;=150</label><label kind="synchronisation" x="212" y="0">TorqueZero!</label></transition><transition><source ref="id127"/><target ref="id120"/><label kind="synchronisation" x="-144" y="-161">ReqZeroTorque?</label><label kind="assignment" x="-144" y="-144">ETimer:=0,
UseCase:=0</label></transition><transition><source ref="id126"/><target ref="id127"/><label kind="guard" x="-459" y="-25">ETimer&lt;500</label><label kind="synchronisation" x="-459" y="-42">ReqTorque?</label></transition></template><template><name>motor</name><declaration>clock ETimer;</declaration><location id="id129" x="212" y="-144"><name x="127" y="-187">DecTorque</name><label kind="invariant" x="102" y="-170">(ETimer&lt;=400)</label></location><location id="id130" x="212" y="221"><name x="238" y="221">Zero</name></location><location id="id131" x="-34" y="221"><name x="-127" y="221">FindSpeed</name><label kind="invariant" x="-110" y="238">(ETimer&lt;=200)</label></location><location id="id132" x="-34" y="-17" color="#ffff00"><name x="-25" y="-42">ClutchOpen</name><committed/></location><location id="id133" x="-255" y="-17"><name x="-339" y="-25">ClutchClose</name><label kind="invariant" x="-331" y="-8">(ETimer&lt;=900)</label></location><location id="id134" x="-255" y="280" color="#ff0000"><name x="-238" y="272">ErrorSpeed</name></location><location id="id135" x="-374" y="221"><name x="-425" y="170">Speed</name><label kind="invariant" x="-408" y="187">(ETimer&lt;=500)</label></location><location id="id136" x="-374" y="-144"><name x="-384" y="-178">Torque</name></location><location id="id137" x="76" y="59"><name x="66" y="25">Initial</name></location><init ref="id137"/><transition><source ref="id131"/><target ref="id132"/><label kind="guard" x="-85" y="42">ETimer==200</label><label kind="assignment" x="-85" y="59">UseCase:=2</label></transition><transition><source ref="id130"/><target ref="id137"/><label kind="guard" x="93" y="93">ToGear==0</label></transition><transition><source ref="id137"/><target ref="id131"/><label kind="synchronisation" x="17" y="136">ReqSpeed[1]?</label><label kind="assignment" x="17" y="153">ETimer:=0,
UseCase:=0</label></transition><transition><source ref="id132"/><target ref="id137"/><label kind="guard" x="-8" y="-8">ToGear==0</label></transition><transition><source ref="id129"/><target ref="id132"/><label kind="guard" x="25" y="-102">ETimer==400</label><label kind="assignment" x="34" y="-85">UseCase:=1</label><nail x="-17" y="-93"/></transition><transition><source ref="id132"/><target ref="id133"/><label kind="guard" x="-195" y="-34">ToGear&gt;0</label><label kind="assignment" x="-194" y="-21">ETimer:=0</label></transition><transition><source ref="id133"/><target ref="id136"/><label kind="guard" x="-323" y="-102">ETimer&gt;=50</label><label kind="synchronisation" x="-340" y="-119">ReqTorque?</label></transition><transition><source ref="id133"/><target ref="id134"/><label kind="guard" x="-255" y="51">ETimer==900</label></transition><transition><source ref="id135"/><target ref="id134"/><label kind="guard" x="-391" y="255">ETimer==500</label></transition><transition><source ref="id131"/><target ref="id135"/><label kind="guard" x="-221" y="195">ETimer&gt;=50</label><label kind="synchronisation" x="-221" y="212">SpeedSet!</label><label kind="assignment" x="-221" y="229">ETimer:=0</label></transition><transition><source ref="id130"/><target ref="id131"/><label kind="guard" x="76" y="221">ToGear&gt;0</label><label kind="synchronisation" x="76" y="238">ReqSpeed[1]?</label><label kind="assignment" x="76" y="255">ETimer:=0</label></transition><transition><source ref="id129"/><target ref="id130"/><label kind="guard" x="212" y="17">ETimer&gt;=150</label><label kind="synchronisation" x="212" y="0">TorqueZero!</label></transition><transition><source ref="id136"/><target ref="id129"/><label kind="synchronisation" x="-144" y="-161">ReqZeroTorque?</label><label kind="assignment" x="-144" y="-144">ETimer:=0,
UseCase:=0</label></transition><transition><source ref="id135"/><target ref="id136"/><label kind="guard" x="-459" y="-25">ETimer&lt;500</label><label kind="synchronisation" x="-459" y="-42">ReqTorque?</label></transition></template><system>// Place template instantiations here.


// List one or more processes to be composed into a system.
system GearControl, GearBox, Clutch, Engine, Interface, driving, InterfaceController, EngineScheduler,motor;
</system></nta>